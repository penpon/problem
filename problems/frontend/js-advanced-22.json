{
  "id": "js-advanced-22",
  "title": "まとめ練習 - カート合計（数量 + 送料 + クーポン）",
  "description": "複数商品の数量変更に応じて小計・送料・クーポン割引を計算し、合計を更新します",
  "category": "javascript-advanced",
  "instructions": [
    "各行の -/+ ボタンと数値入力で数量を変更",
    "送料は #shippingSelect（0: 通常¥500 / 1: 無料¥0）",
    "クーポン SAVE10 を適用すると小計の10%割引",
    "小計は #sumSubtotal、送料は #sumShipping、合計は #sumTotal に表示し、#statusText に状態表示"
  ],
  "files": {
    "html": {
      "template": "<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n  <title>js-advanced-22 まとめ練習 - カート合計（数量+送料+クーポン）</title>\n  <link rel=\"stylesheet\" href=\"style.css\" />\n</head>\n<body>\n  <div class=\"container\">\n    <h1>まとめ練習 - カート合計（数量 + 送料 + クーポン）</h1>\n\n    <div class=\"cart\">\n      <div class=\"cart-row header\">\n        <div>商品</div>\n        <div>価格</div>\n        <div>数量</div>\n        <div>小計</div>\n      </div>\n      <div class=\"cart-row\" data-id=\"1\">\n        <div class=\"title\">Mini Tripod</div>\n        <div class=\"price\" data-price=\"1800\">¥1,800</div>\n        <div class=\"qty\">\n          <button class=\"dec\" type=\"button\">-</button>\n          <input class=\"qty-input\" type=\"number\" value=\"1\" min=\"0\" />\n          <button class=\"inc\" type=\"button\">+</button>\n        </div>\n        <div class=\"subtotal\">¥1,800</div>\n      </div>\n      <div class=\"cart-row\" data-id=\"2\">\n        <div class=\"title\">Light Stand</div>\n        <div class=\"price\" data-price=\"3200\">¥3,200</div>\n        <div class=\"qty\">\n          <button class=\"dec\" type=\"button\">-</button>\n          <input class=\"qty-input\" type=\"number\" value=\"1\" min=\"0\" />\n          <button class=\"inc\" type=\"button\">+</button>\n        </div>\n        <div class=\"subtotal\">¥3,200</div>\n      </div>\n    </div>\n\n    <div class=\"controls\">\n      <label for=\"shippingSelect\">送料</label>\n      <select id=\"shippingSelect\">\n        <option value=\"0\">通常(¥500)</option>\n        <option value=\"1\">無料(¥0)</option>\n      </select>\n\n      <label for=\"couponInput\">クーポン</label>\n      <input id=\"couponInput\" type=\"text\" placeholder=\"SAVE10\" />\n      <button id=\"applyBtn\" type=\"button\">適用</button>\n    </div>\n\n    <div class=\"summary\">\n      <div>小計: <span id=\"sumSubtotal\">¥0</span></div>\n      <div>送料: <span id=\"sumShipping\">¥0</span></div>\n      <div class=\"total\">合計: <span id=\"sumTotal\">¥0</span></div>\n      <div class=\"meta\" id=\"statusText\">未計算</div>\n    </div>\n  </div>\n\n  <script src=\"script.js\"></script>\n</body>\n</html>\n",
      "expected": "__INCLUDE__: problems/frontend/expected/js-advanced-22/files.html.expected"
    },
    "css": {
      "template": "body{font-family:system-ui,-apple-system,\\\"Segoe UI\\\",sans-serif;margin:16px}\n.container{max-width:800px;margin:auto}\n.cart{border:1px solid #e5e7eb;border-radius:8px}\n.cart-row{display:grid;grid-template-columns:2fr 1fr 1.5fr 1fr;gap:8px;padding:8px 12px;align-items:center}\n.cart-row.header{background:#f8f8f8;font-weight:600}\n.qty{display:flex;gap:6px;align-items:center}\n.qty-input{width:64px;padding:6px;border:1px solid #ccc;border-radius:6px}\nbutton{padding:6px 10px;border:1px solid #ccc;border-radius:6px;background:#fff}\n.controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin:16px 0}\n.summary{border-top:1px solid #e5e7eb;padding-top:12px}\n.total{font-size:18px;font-weight:700}\n.meta{color:#666}\n",
      "expected": "__INCLUDE__: problems/frontend/expected/js-advanced-22/files.css.expected"
    },
    "js": {
      "template": "const rows = Array.from(document.querySelectorAll('.cart-row[data-id]'));\nconst $shipping = document.getElementById('shippingSelect');\nconst $coupon = document.getElementById('couponInput');\nconst $apply = document.getElementById('applyBtn');\nconst $sumSubtotal = document.getElementById('sumSubtotal');\nconst $sumShipping = document.getElementById('sumShipping');\nconst $sumTotal = document.getElementById('sumTotal');\nconst $status = document.getElementById('statusText');\n\nfunction formatYen(n){ return `¥${n.toLocaleString()}`; }\n\nfunction recalc() {\n  let subtotal = 0;\n  for (const row of rows) {\n    const price = Number(row.querySelector('.price').dataset.price);\n    const qty = Math.max(0, Number(row.querySelector('.qty-input').value || 0));\n    const st = price * qty;\n    row.querySelector('.subtotal').textContent = formatYen(st);\n    subtotal += st;\n  }\n  // shipping: 0 => 500yen, 1 => 0yen\n  const ship = $shipping.value === '0' ? 500 : 0;\n\n  // coupon: SAVE10 => 10% off on subtotal\n  let discount = 0;\n  const code = ($coupon.value || '').trim().toUpperCase();\n  if (code === 'SAVE10') {\n    discount = Math.floor(subtotal * 0.1);\n  }\n\n  const total = Math.max(0, subtotal - discount + ship);\n\n  $sumSubtotal.textContent = formatYen(subtotal - discount);\n  $sumShipping.textContent = formatYen(ship);\n  $sumTotal.textContent = formatYen(total);\n  $status.textContent = '計算済み';\n}\n\nfor (const row of rows) {\n  const $dec = row.querySelector('.dec');\n  const $inc = row.querySelector('.inc');\n  const $input = row.querySelector('.qty-input');\n  $dec.addEventListener('click', () => { $input.value = Math.max(0, Number($input.value||0) - 1); recalc(); });\n  $inc.addEventListener('click', () => { $input.value = Number($input.value||0) + 1; recalc(); });\n  $input.addEventListener('input', recalc);\n}\n$shipping.addEventListener('change', recalc);\n$apply.addEventListener('click', recalc);\n\n// 初期計算\nrecalc();\n",
      "expected": "__INCLUDE__: problems/frontend/expected/js-advanced-22/files.js.expected"
    }
  },
  "checks": [
    { "id": "doctype", "name": "DOCTYPE宣言", "type": "structure", "message": "DOCTYPE html宣言が必要です" },
    { "id": "html", "name": "<html>タグ", "type": "structure", "message": "<html>タグが必要です" },
    { "id": "head", "name": "<head>セクション", "type": "structure", "message": "<head>セクションが必要です" },
    { "id": "body", "name": "<body>セクション", "type": "structure", "message": "<body>セクションが必要です" },
    { "id": "title", "name": "<title>タグ", "type": "structure", "message": "<title>タグと内容が必要です" },
    { "id": "css-content", "name": "CSSスタイル", "type": "css", "message": "CSSでスタイルを設定してください" },
    { "id": "js-content", "name": "JavaScript", "type": "js", "message": "JavaScriptで動的な動作を実装してください" }
  ]
}
