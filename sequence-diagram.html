<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éï„É≠„ÉºÂõ≥ÁîüÊàê„ÉÑ„Éº„É´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 20px auto 0;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .main-content {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            align-items: flex-start;
        }

        .left-panel {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: auto auto auto;
            gap: 20px;
        }

        .right-panel {
            flex: 0 0 600px;
            height: calc(100vh - 200px);
            position: sticky;
            top: 20px;
            min-width: 400px;
            max-width: 800px;
            align-self: flex-start;
        }

        .resize-handle {
            width: 8px;
            height: calc(100vh - 200px);
            background: #ddd;
            cursor: col-resize;
            position: sticky;
            top: 20px;
            border-left: 1px solid #ccc;
            border-right: 1px solid #ccc;
            transition: background 0.2s ease;
            align-self: flex-start;
        }

        .resize-handle:hover {
            background: #bbb;
        }

        .resize-handle::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 3px;
            height: 30px;
            background: #888;
            border-radius: 2px;
        }

        .input-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }

        .control-section {
            background: #f1f3f4;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #dadce0;
        }

        .sample-section {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e5e7eb;
        }

        .diagram-section {
            background: #f0fdf4;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #bbf7d0;
            height: calc(100vh - 240px);
            max-height: calc(100vh - 240px);
            overflow-y: auto;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .diagram-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #bbf7d0;
            padding-bottom: 10px;
        }

        .diagram-header h2 {
            margin: 0;
            color: #059669;
        }

        .code-input {
            width: 100%;
            height: 300px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            background: #fff;
            resize: vertical;
        }

        .controls {
            text-align: center;
            margin: 30px 0;
        }

        .control-group {
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            background: linear-gradient(145deg, #2196f3, #1976d2);
            color: white;
            border: none;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .generate-btn {
            background: linear-gradient(145deg, #4caf50, #45a049);
        }

        .generate-btn:hover {
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .reset-btn {
            background: linear-gradient(145deg, #ff9800, #f57c00);
        }

        .reset-btn:hover {
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.4);
        }

        .download-btn {
            background: linear-gradient(145deg, #9c27b0, #7b1fa2);
        }

        .download-btn:hover {
            box-shadow: 0 5px 15px rgba(156, 39, 176, 0.4);
        }

        .sample-code-btn {
            background: linear-gradient(145deg, #4caf50, #45a049);
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .sample-code-btn:hover {
            background: linear-gradient(145deg, #45a049, #4caf50);
        }

        #diagramContainer {
            flex: 1;
            min-height: 300px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loading {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            color: #f44336;
            font-weight: bold;
            background: #ffebee;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .success-message {
            color: #4caf50;
            font-weight: bold;
            background: #f1f8e9;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .right-panel,
            .resize-handle {
                position: relative;
                top: auto;
                height: auto;
                min-height: 400px;
            }
            
            .diagram-section {
                height: auto;
                max-height: 500px;
            }
        }

        @media (max-width: 768px) {
            .control-group {
                flex-direction: column;
                gap: 10px;
            }
            
            button {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìà „Éï„É≠„ÉºÂõ≥ÁîüÊàê„ÉÑ„Éº„É´</h1>
        
        <div class="main-content">
            <div class="left-panel">
                <div class="input-section">
                    <h2>üìù „Ç≥„Éº„ÉâÂÖ•Âäõ</h2>
                    <textarea 
                        id="codeInput" 
                        class="code-input" 
                        placeholder="„Åì„Åì„Å´JavaScript„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...&#10;Èñ¢Êï∞Âëº„Å≥Âá∫„Åó„ÇÑ„ÇØ„É©„ÇπÈñì„ÅÆÁõ∏‰∫í‰ΩúÁî®„Çí„Ç∑„Éº„Ç±„É≥„ÇπÂõ≥„Å®„Åó„Å¶ÂèØË¶ñÂåñ„Åó„Åæ„Åô„ÄÇ"
                    ></textarea>
                </div>

                <div class="control-section">
                    <h2>‚öôÔ∏è ÁîüÊàêÂà∂Âæ°</h2>
                    <div class="controls">
                        <div class="control-group">
                            <button id="generateBtn" class="generate-btn" onclick="generateDiagram()">
                                üöÄ „Ç∑„Éº„Ç±„É≥„ÇπÂõ≥ÁîüÊàê
                            </button>
                            <button class="reset-btn" onclick="resetTool()">
                                üîÑ „É™„Çª„ÉÉ„Éà
                            </button>
                        </div>
                        
                        <div class="control-group">
                            <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0;">
                                <label for="pngScale" style="font-weight: bold;">PNGËß£ÂÉèÂ∫¶:</label>
                                <select id="pngScale" style="padding: 5px 10px; border-radius: 5px; border: 2px solid #ddd;">
                                    <option value="1">Ê®ôÊ∫ñ (1x)</option>
                                    <option value="2" selected>È´òËß£ÂÉèÂ∫¶ (2x)</option>
                                    <option value="3">Ë∂ÖÈ´òËß£ÂÉèÂ∫¶ (3x)</option>
                                    <option value="4">ÊúÄÈ´òËß£ÂÉèÂ∫¶ (4x)</option>
                                </select>
                            </div>
                            <button id="downloadPngBtn" class="download-btn" onclick="downloadDiagram('png')" disabled>
                                üíæ PNG‰øùÂ≠ò
                            </button>
                            <button id="downloadSvgBtn" class="download-btn" onclick="downloadDiagram('svg')" disabled>
                                üíæ SVG‰øùÂ≠ò
                            </button>
                            <button id="downloadTextBtn" class="download-btn" onclick="downloadDiagram('text')" disabled>
                                üíæ „Ç≥„Éº„Éâ‰øùÂ≠ò
                            </button>
                        </div>
                    </div>
                </div>

                <div class="sample-section">
                    <h2>üìã „Çµ„É≥„Éó„É´„Ç≥„Éº„Éâ</h2>
                    <button class="sample-code-btn" onclick="loadSampleCode('basic')">Âü∫Êú¨ÁöÑ„Å™Èñ¢Êï∞Âëº„Å≥Âá∫„Åó</button>
                    <button class="sample-code-btn" onclick="loadSampleCode('class')">„ÇØ„É©„ÇπÈñìÁõ∏‰∫í‰ΩúÁî®</button>
                    <button class="sample-code-btn" onclick="loadSampleCode('api')">APIÂëº„Å≥Âá∫„Åó</button>
                    <button class="sample-code-btn" onclick="loadSampleCode('async')">ÈùûÂêåÊúüÂá¶ÁêÜ</button>
                    <button class="sample-code-btn" onclick="loadSampleCode('complex')">Ë§áÈõë„Å™Âá¶ÁêÜ„Éï„É≠„Éº</button>
                </div>
            </div>

            <div class="resize-handle" id="resizeHandle"></div>

            <div class="right-panel" id="rightPanel">
                <div class="diagram-section">
                    <div class="diagram-header">
                        <h2>üìä „Ç∑„Éº„Ç±„É≥„ÇπÂõ≥</h2>
                    </div>
                    <div id="diagramContainer">
                        <div style="text-align: center; color: #666;">
                            <h3>üéØ ‰ΩøÁî®ÊñπÊ≥ï</h3>
                            <p style="margin: 15px 0;">1. Â∑¶ÂÅ¥„Å´JavaScript„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ</p>
                            <p style="margin: 15px 0;">2. „Äå„Ç∑„Éº„Ç±„É≥„ÇπÂõ≥ÁîüÊàê„Äç„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ</p>
                            <p style="margin: 15px 0;">3. ÁîüÊàê„Åï„Çå„Åü„Ç∑„Éº„Ç±„É≥„ÇπÂõ≥„ÇíÁ¢∫Ë™ç„Éª„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</p>
                            <p style="margin-top: 20px; font-size: 0.9em;">üí° „Çµ„É≥„Éó„É´„Ç≥„Éº„Éâ„Åã„ÇâÂßã„ÇÅ„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mermaid.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let currentMermaidCode = '';
        let isProcessing = false;

        // Mermaid„ÅÆÂàùÊúüÂåñ
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            securityLevel: 'loose',
            sequence: {
                diagramMarginX: 50,
                diagramMarginY: 10,
                actorMargin: 50,
                width: 150,
                height: 65,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageMargin: 35,
                mirrorActors: true,
                bottomMarginAdj: 1,
                useMaxWidth: true,
                rightAngles: false,
                showSequenceNumbers: false
            }
        });

        // „Çµ„É≥„Éó„É´„Ç≥„Éº„Éâ
        const sampleCodes = {
            basic: `// Âü∫Êú¨ÁöÑ„Å™Èñ¢Êï∞Âëº„Å≥Âá∫„Åó
function main() {
    console.log("„Éó„É≠„Ç∞„É©„É†ÈñãÂßã");
    processData();
    console.log("„Éó„É≠„Ç∞„É©„É†ÁµÇ‰∫Ü");
}

function processData() {
    const data = getData();
    const result = calculateResult(data);
    saveResult(result);
}

function getData() {
    return "„Çµ„É≥„Éó„É´„Éá„Éº„Çø";
}

function calculateResult(data) {
    return data + " - Âá¶ÁêÜÊ∏à„Åø";
}

function saveResult(result) {
    console.log("ÁµêÊûú‰øùÂ≠ò:", result);
}

main();`,

            class: `// „ÇØ„É©„ÇπÈñì„ÅÆÁõ∏‰∫í‰ΩúÁî®
class UserService {
    constructor() {
        this.database = new Database();
        this.emailService = new EmailService();
    }
    
    createUser(userData) {
        const user = this.database.save(userData);
        this.emailService.sendWelcomeEmail(user.email);
        return user;
    }
}

class Database {
    save(data) {
        console.log("„Éá„Éº„Çø„Éô„Éº„Çπ„Å´‰øùÂ≠ò:", data);
        return { id: 1, ...data };
    }
}

class EmailService {
    sendWelcomeEmail(email) {
        console.log("„Ç¶„Çß„É´„Ç´„É†„É°„Éº„É´ÈÄÅ‰ø°:", email);
    }
}

const userService = new UserService();
userService.createUser({ name: "Â§™ÈÉé", email: "taro@example.com" });`,

            api: `// APIÂëº„Å≥Âá∫„Åó„ÅÆÊµÅ„Çå
class ApiClient {
    constructor() {
        this.authService = new AuthService();
    }
    
    async fetchUserData(userId) {
        const token = await this.authService.getToken();
        const userData = await this.makeRequest('/users/' + userId, token);
        return this.processUserData(userData);
    }
    
    async makeRequest(endpoint, token) {
        console.log("APIÂëº„Å≥Âá∫„Åó:", endpoint);
        return { id: 1, name: "„É¶„Éº„Ç∂„Éº1" };
    }
    
    processUserData(data) {
        console.log("„É¶„Éº„Ç∂„Éº„Éá„Éº„ÇøÂá¶ÁêÜ:", data);
        return data;
    }
}

class AuthService {
    async getToken() {
        console.log("Ë™çË®º„Éà„Éº„ÇØ„É≥ÂèñÂæó");
        return "token123";
    }
}

const client = new ApiClient();
client.fetchUserData(1);`,

            async: `// ÈùûÂêåÊúüÂá¶ÁêÜ„ÅÆ„Éï„É≠„Éº
class TaskManager {
    constructor() {
        this.queue = new TaskQueue();
        this.processor = new TaskProcessor();
    }
    
    async executeTask(taskData) {
        await this.queue.add(taskData);
        const task = await this.queue.get();
        const result = await this.processor.process(task);
        await this.handleResult(result);
    }
    
    async handleResult(result) {
        console.log("„Çø„Çπ„ÇØÂÆå‰∫Ü:", result);
    }
}

class TaskQueue {
    async add(task) {
        console.log("„Çø„Çπ„ÇØ„Çí„Ç≠„É•„Éº„Å´ËøΩÂä†:", task);
    }
    
    async get() {
        console.log("„Ç≠„É•„Éº„Åã„Çâ„Çø„Çπ„ÇØÂèñÂæó");
        return { id: 1, type: "process" };
    }
}

class TaskProcessor {
    async process(task) {
        console.log("„Çø„Çπ„ÇØÂá¶ÁêÜÈñãÂßã:", task);
        await this.delay(1000);
        console.log("„Çø„Çπ„ÇØÂá¶ÁêÜÂÆå‰∫Ü");
        return "Âá¶ÁêÜÁµêÊûú";
    }
    
    delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
}

const manager = new TaskManager();
manager.executeTask({ type: "important", data: "„ÉÜ„Çπ„Éà„Éá„Éº„Çø" });`,

            complex: `// Ë§áÈõë„Å™Âá¶ÁêÜ„Éï„É≠„Éº„ÅÆ‰æã
class OrderProcessor {
    constructor() {
        this.validator = new OrderValidator();
        this.paymentService = new PaymentService();
        this.inventoryService = new InventoryService();
        this.shippingService = new ShippingService();
        this.notificationService = new NotificationService();
    }
    
    async processOrder(orderData) {
        try {
            // 1. Ê≥®Êñá„ÅÆÊ§úË®º
            await this.validator.validate(orderData);
            
            // 2. Âú®Â∫´Á¢∫Ë™ç
            await this.inventoryService.checkAvailability(orderData.items);
            
            // 3. Ê±∫Ê∏àÂá¶ÁêÜ
            const paymentResult = await this.paymentService.processPayment(orderData.payment);
            
            // 4. ÈÖçÈÄÅÊâãÁ∂ö„Åç
            const shippingInfo = await this.shippingService.arrangeShipping(orderData);
            
            // 5. ÈÄöÁü•ÈÄÅ‰ø°
            await this.notificationService.sendConfirmation(orderData.customerEmail, {
                payment: paymentResult,
                shipping: shippingInfo
            });
            
            return { success: true, orderId: orderData.id };
            
        } catch (error) {
            await this.handleOrderError(error, orderData);
            throw error;
        }
    }
    
    async handleOrderError(error, orderData) {
        console.log("Ê≥®Êñá„Ç®„É©„ÉºÂá¶ÁêÜ:", error.message);
        await this.notificationService.sendErrorNotification(orderData.customerEmail, error);
    }
}

class OrderValidator {
    async validate(orderData) {
        console.log("Ê≥®Êñá„Éá„Éº„ÇøÊ§úË®º");
        if (!orderData.items || orderData.items.length === 0) {
            throw new Error("ÂïÜÂìÅ„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì");
        }
    }
}

class PaymentService {
    async processPayment(paymentData) {
        console.log("Ê±∫Ê∏àÂá¶ÁêÜÈñãÂßã");
        return { transactionId: "tx123", status: "completed" };
    }
}

class InventoryService {
    async checkAvailability(items) {
        console.log("Âú®Â∫´Á¢∫Ë™ç:", items);
        return true;
    }
}

class ShippingService {
    async arrangeShipping(orderData) {
        console.log("ÈÖçÈÄÅÊâãÁ∂ö„Åç");
        return { trackingNumber: "track123", estimatedDelivery: "2Êó•Âæå" };
    }
}

class NotificationService {
    async sendConfirmation(email, orderInfo) {
        console.log("Á¢∫Ë™ç„É°„Éº„É´ÈÄÅ‰ø°:", email);
    }
    
    async sendErrorNotification(email, error) {
        console.log("„Ç®„É©„ÉºÈÄöÁü•ÈÄÅ‰ø°:", email, error.message);
    }
}

// ÂÆüÈöõ„ÅÆÂá¶ÁêÜÂÆüË°å
const processor = new OrderProcessor();
processor.processOrder({
    id: "order123",
    customerEmail: "customer@example.com",
    items: [{ id: 1, name: "ÂïÜÂìÅA", quantity: 2 }],
    payment: { method: "credit_card", amount: 1000 }
});`
        };

        // „Çµ„É≥„Éó„É´„Ç≥„Éº„Éâ„ÅÆË™≠„ÅøËæº„Åø
        function loadSampleCode(type) {
            if (sampleCodes[type]) {
                document.getElementById('codeInput').value = sampleCodes[type];
            }
        }

        // „Ç≥„Éº„ÉâËß£Êûê„ÇØ„É©„Çπ
        class CodeAnalyzer {
            constructor(code) {
                this.code = code;
                this.actors = new Set();
                this.interactions = [];
            }

            analyze() {
                const lines = this.code.split('\n');
                let currentClass = null;
                let currentFunction = null;
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    // „ÇØ„É©„ÇπÂÆöÁæ©„ÅÆÊ§úÂá∫
                    const classMatch = line.match(/class\s+(\w+)/);
                    if (classMatch) {
                        currentClass = classMatch[1];
                        this.actors.add(currentClass);
                        continue;
                    }
                    
                    // Èñ¢Êï∞ÂÆöÁæ©„ÅÆÊ§úÂá∫
                    const funcMatch = line.match(/(?:function\s+(\w+)|(\w+)\s*\([^)]*\)\s*\{)/);
                    if (funcMatch) {
                        currentFunction = funcMatch[1] || funcMatch[2];
                        if (!currentClass) {
                            // Ê§úÂá∫„Åï„Çå„ÅüÈñ¢Êï∞Âêç„ÇíÂÄãÂà•„Ç¢„ÇØ„Çø„Éº„Å®„Åó„Å¶ËøΩÂä†
                            this.actors.add(currentFunction);
                            this.actors.add('Main');
                        }
                        continue;
                    }
                    
                    // „É°„ÇΩ„ÉÉ„ÉâÂëº„Å≥Âá∫„Åó„ÅÆÊ§úÂá∫
                    this.detectMethodCalls(line, currentClass, currentFunction);
                    
                    // Èñ¢Êï∞Âëº„Å≥Âá∫„Åó„ÅÆÊ§úÂá∫
                    this.detectFunctionCalls(line, currentClass, currentFunction);
                    
                    // console.log„ÅÆÊ§úÂá∫
                    this.detectConsoleLog(line, currentClass, currentFunction);
                }
                
                return this.generateMermaidCode();
            }

            detectMethodCalls(line, currentClass, currentFunction) {
                // this.method() „Éë„Çø„Éº„É≥
                const thisCallMatch = line.match(/this\.(\w+)\s*\(/g);
                if (thisCallMatch && currentClass) {
                    thisCallMatch.forEach(match => {
                        const method = match.match(/this\.(\w+)/)[1];
                        this.interactions.push({
                            from: currentClass,
                            to: currentClass,
                            message: method + "()",
                            type: 'self'
                        });
                    });
                }
                
                // object.method() „Éë„Çø„Éº„É≥
                const objCallMatch = line.match(/(\w+)\.(\w+)\s*\(/g);
                if (objCallMatch && currentClass) {
                    objCallMatch.forEach(match => {
                        const [, obj, method] = match.match(/(\w+)\.(\w+)/);
                        if (obj !== 'console' && obj !== 'this') {
                            // „Ç™„Éñ„Ç∏„Çß„ÇØ„ÉàÂêç„Åã„ÇâÊé®ÂÆö„Åï„Çå„ÇãÂèØËÉΩÊÄß„ÅÆ„ÅÇ„Çã„ÇØ„É©„ÇπÂêç
                            const targetClass = this.guessClassName(obj);
                            this.actors.add(targetClass);
                            this.interactions.push({
                                from: currentClass || 'Main',
                                to: targetClass,
                                message: method + "()",
                                type: 'call'
                            });
                        }
                    });
                }
            }

            detectFunctionCalls(line, currentClass, currentFunction) {
                // Áã¨Á´ã„Åó„ÅüÈñ¢Êï∞Âëº„Å≥Âá∫„Åó function() „Éë„Çø„Éº„É≥
                const funcCallMatch = line.match(/(?:^|\s|=|\(|\{)(\w+)\s*\(/g);
                if (funcCallMatch) {
                    funcCallMatch.forEach(match => {
                        let funcName = match.match(/(\w+)\s*\($/);
                        if (funcName) {
                            funcName = funcName[1];
                            // ‰∫àÁ¥ÑË™û„ÇÑÊó¢Áü•„ÅÆ„É°„ÇΩ„ÉÉ„Éâ„Çí„Çπ„Ç≠„ÉÉ„Éó
                            if (!['if', 'for', 'while', 'switch', 'catch', 'return', 'new', 'console'].includes(funcName)) {
                                // Ê§úÂá∫„Åï„Çå„ÅüÈñ¢Êï∞Âêç„ÇíÂÄãÂà•„Ç¢„ÇØ„Çø„Éº„Å®„Åó„Å¶ËøΩÂä†
                                this.actors.add(funcName);
                                
                                // Ê≠£„Åó„ÅÑÂëº„Å≥Âá∫„ÅóÈñ¢‰øÇ„ÇíË®≠ÂÆö
                                const fromActor = currentFunction || currentClass || 'Main';
                                this.actors.add(fromActor);
                                
                                this.interactions.push({
                                    from: fromActor,
                                    to: funcName,
                                    message: funcName + "()",
                                    type: 'call'
                                });
                            }
                        }
                    });
                }
            }

            detectConsoleLog(line, currentClass, currentFunction) {
                if (line.includes('console.log')) {
                    const logMatch = line.match(/console\.log\s*\(\s*["']([^"']+)["']/);
                    if (logMatch) {
                        this.actors.add('Console');
                        this.interactions.push({
                            from: currentClass || 'Main',
                            to: 'Console',
                            message: logMatch[1],
                            type: 'log'
                        });
                    }
                }
            }

            guessClassName(objName) {
                // „Ç™„Éñ„Ç∏„Çß„ÇØ„ÉàÂêç„Åã„Çâ„ÇØ„É©„ÇπÂêç„ÇíÊé®Ê∏¨
                const commonMappings = {
                    'database': 'Database',
                    'emailService': 'EmailService',
                    'userService': 'UserService',
                    'authService': 'AuthService',
                    'paymentService': 'PaymentService',
                    'inventoryService': 'InventoryService',
                    'shippingService': 'ShippingService',
                    'notificationService': 'NotificationService',
                    'queue': 'TaskQueue',
                    'processor': 'TaskProcessor',
                    'validator': 'OrderValidator'
                };
                
                return commonMappings[objName] || this.capitalizeFirst(objName);
            }

            capitalizeFirst(str) {
                return str.charAt(0).toUpperCase() + str.slice(1);
            }

            generateMermaidCode() {
                let mermaidCode = 'sequenceDiagram\n';
                
                // „Ç¢„ÇØ„Çø„Éº„ÅÆËøΩÂä†
                const actorList = Array.from(this.actors);
                actorList.forEach(actor => {
                    mermaidCode += `    participant ${actor}\n`;
                });
                
                mermaidCode += '\n';
                
                // „Ç§„É≥„Çø„É©„ÇØ„Ç∑„Éß„É≥„ÅÆËøΩÂä†
                this.interactions.forEach(interaction => {
                    if (interaction.type === 'log') {
                        mermaidCode += `    ${interaction.from}-->>+${interaction.to}: ${interaction.message}\n`;
                        mermaidCode += `    ${interaction.to}-->>-${interaction.from}: „É≠„Ç∞Âá∫Âäõ\n`;
                    } else if (interaction.type === 'self') {
                        mermaidCode += `    ${interaction.from}-->>+${interaction.to}: ${interaction.message}\n`;
                        mermaidCode += `    ${interaction.to}-->>-${interaction.from}: Âá¶ÁêÜÂÆå‰∫Ü\n`;
                    } else {
                        mermaidCode += `    ${interaction.from}->>+${interaction.to}: ${interaction.message}\n`;
                        mermaidCode += `    ${interaction.to}-->>-${interaction.from}: Êàª„ÇäÂÄ§\n`;
                    }
                });
                
                return mermaidCode;
            }
        }

        // „Ç∑„Éº„Ç±„É≥„ÇπÂõ≥ÁîüÊàê
        async function generateDiagram() {
            const codeInput = document.getElementById('codeInput').value.trim();
            
            if (!codeInput) {
                showMessage('„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 'error');
                return;
            }
            
            if (isProcessing) {
                return;
            }
            
            isProcessing = true;
            const generateBtn = document.getElementById('generateBtn');
            const originalText = generateBtn.textContent;
            generateBtn.textContent = 'ÁîüÊàê‰∏≠...';
            generateBtn.disabled = true;
            
            const diagramContainer = document.getElementById('diagramContainer');
            diagramContainer.innerHTML = '<div class="loading"></div><p>„Ç∑„Éº„Ç±„É≥„ÇπÂõ≥„ÇíÁîüÊàê‰∏≠...</p>';
            
            try {
                // „Ç≥„Éº„ÉâËß£Êûê
                const analyzer = new CodeAnalyzer(codeInput);
                const mermaidCode = analyzer.analyze();
                currentMermaidCode = mermaidCode;
                
                // Mermaid„Åß„É¨„É≥„ÉÄ„É™„É≥„Ç∞
                const diagramId = 'diagram-' + Date.now();
                const { svg } = await mermaid.render(diagramId, mermaidCode);
                
                diagramContainer.innerHTML = svg;
                
                // „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Éú„Çø„É≥„ÇíÊúâÂäπÂåñ
                document.getElementById('downloadPngBtn').disabled = false;
                document.getElementById('downloadSvgBtn').disabled = false;
                document.getElementById('downloadTextBtn').disabled = false;
                
                showMessage('„Ç∑„Éº„Ç±„É≥„ÇπÂõ≥„ÇíÁîüÊàê„Åó„Åæ„Åó„ÅüÔºÅ', 'success');
                
            } catch (error) {
                console.error('Diagram generation error:', error);
                diagramContainer.innerHTML = `
                    <div class="error-message">
                        <h3>„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü</h3>
                        <p>${error.message || '‰∏çÊòé„Å™„Ç®„É©„Éº„Åß„Åô'}</p>
                        <p>„Ç≥„Éº„Éâ„ÇíÁ¢∫Ë™ç„Åó„Å¶ÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                    </div>
                `;
                showMessage('„Ç∑„Éº„Ç±„É≥„ÇπÂõ≥„ÅÆÁîüÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ', 'error');
            } finally {
                isProcessing = false;
                generateBtn.textContent = originalText;
                generateBtn.disabled = false;
            }
        }

        // „ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÊ©üËÉΩ
        function downloadDiagram(format) {
            if (!currentMermaidCode && format !== 'text') {
                showMessage('ÂÖà„Å´„Ç∑„Éº„Ç±„É≥„ÇπÂõ≥„ÇíÁîüÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 'error');
                return;
            }
            
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            
            if (format === 'png') {
                downloadPNG(timestamp);
            } else if (format === 'svg') {
                downloadSVG(timestamp);
            } else if (format === 'text') {
                downloadText(timestamp);
            }
        }

        function downloadPNG(timestamp) {
            const svgElement = document.querySelector('#diagramContainer svg');
            if (!svgElement) {
                showMessage('SVG„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ', 'error');
                return;
            }
            
            // „Çπ„Ç±„Éº„É´„Éï„Ç°„ÇØ„Çø„Éº„ÇíÂèñÂæó
            const scaleSelect = document.getElementById('pngScale');
            const scale = parseInt(scaleSelect.value) || 2;
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // SVG„ÅÆÂÖÉ„ÅÆ„Çµ„Ç§„Ç∫„ÇíÂèñÂæó
            const svgRect = svgElement.getBoundingClientRect();
            const originalWidth = svgRect.width || svgElement.clientWidth || 800;
            const originalHeight = svgRect.height || svgElement.clientHeight || 600;
            
            // È´òËß£ÂÉèÂ∫¶ÂØæÂøú: canvas„Çµ„Ç§„Ç∫„Çí„Çπ„Ç±„Éº„É´ÂÄç„Å´Ë®≠ÂÆö
            canvas.width = originalWidth * scale;
            canvas.height = originalHeight * scale;
            
            // È´òËß£ÂÉèÂ∫¶ÊèèÁîª„ÅÆ„Åü„ÇÅ„ÅÆ„Ç≥„É≥„ÉÜ„Ç≠„Çπ„ÉàË®≠ÂÆö
            ctx.scale(scale, scale);
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            
            const svgData = new XMLSerializer().serializeToString(svgElement);
            const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
            const url = URL.createObjectURL(svgBlob);
            
            const img = new Image();
            img.onload = function() {
                // ÁôΩ„ÅÑËÉåÊôØ„ÇíÊèèÁîª
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, originalWidth, originalHeight);
                
                // È´òËß£ÂÉèÂ∫¶„ÅßSVG„ÇíÊèèÁîª
                ctx.drawImage(img, 0, 0, originalWidth, originalHeight);
                
                // PNGÂìÅË≥™Ë®≠ÂÆö„ÅßBlobÁîüÊàê
                canvas.toBlob(function(blob) {
                    const downloadUrl = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = downloadUrl;
                    a.download = `sequence-diagram-${scale}x-${timestamp}.png`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(downloadUrl);
                    showMessage(`PNG(${scale}xËß£ÂÉèÂ∫¶)„Éï„Ç°„Ç§„É´„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü„ÄÇ`, 'success');
                }, 'image/png', 0.95); // È´òÂìÅË≥™PNG
                
                URL.revokeObjectURL(url);
            };
            
            img.onerror = function() {
                showMessage('PNGÁîüÊàê‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ', 'error');
                URL.revokeObjectURL(url);
            };
            
            img.src = url;
        }

        function downloadSVG(timestamp) {
            const svgElement = document.querySelector('#diagramContainer svg');
            if (!svgElement) {
                showMessage('SVG„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ', 'error');
                return;
            }
            
            const svgData = new XMLSerializer().serializeToString(svgElement);
            const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
            const url = URL.createObjectURL(svgBlob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `sequence-diagram-${timestamp}.svg`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showMessage('SVG„Éï„Ç°„Ç§„É´„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü„ÄÇ', 'success');
        }

        function downloadText(timestamp) {
            const code = currentMermaidCode || '// „Åæ„Åö„Ç∑„Éº„Ç±„É≥„ÇπÂõ≥„ÇíÁîüÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
            const blob = new Blob([code], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `mermaid-code-${timestamp}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showMessage('Mermaid„Ç≥„Éº„Éâ„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü„ÄÇ', 'success');
        }

        // „ÉÑ„Éº„É´„É™„Çª„ÉÉ„Éà
        function resetTool() {
            document.getElementById('codeInput').value = '';
            document.getElementById('diagramContainer').innerHTML = `
                <div style="text-align: center; color: #666;">
                    <h3>üéØ ‰ΩøÁî®ÊñπÊ≥ï</h3>
                    <p style="margin: 15px 0;">1. Â∑¶ÂÅ¥„Å´JavaScript„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ</p>
                    <p style="margin: 15px 0;">2. „Äå„Ç∑„Éº„Ç±„É≥„ÇπÂõ≥ÁîüÊàê„Äç„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ</p>
                    <p style="margin: 15px 0;">3. ÁîüÊàê„Åï„Çå„Åü„Ç∑„Éº„Ç±„É≥„ÇπÂõ≥„ÇíÁ¢∫Ë™ç„Éª„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</p>
                    <p style="margin-top: 20px; font-size: 0.9em;">üí° „Çµ„É≥„Éó„É´„Ç≥„Éº„Éâ„Åã„ÇâÂßã„ÇÅ„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ</p>
                </div>
            `;
            currentMermaidCode = '';
            
            // „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ
            document.getElementById('downloadPngBtn').disabled = true;
            document.getElementById('downloadSvgBtn').disabled = true;
            document.getElementById('downloadTextBtn').disabled = true;
            
            clearMessages();
        }

        // „É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
        function showMessage(message, type) {
            clearMessages();
            
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.textContent = message;
            
            const controlSection = document.querySelector('.control-section');
            controlSection.appendChild(messageDiv);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 5000);
        }

        function clearMessages() {
            const messages = document.querySelectorAll('.error-message, .success-message');
            messages.forEach(msg => msg.remove());
        }

        // „Éë„Éç„É´„É™„Çµ„Ç§„Ç∫Ê©üËÉΩ
        let isResizing = false;
        let startX = 0;
        let startWidth = 0;

        function initializeResize() {
            const resizeHandle = document.getElementById('resizeHandle');
            const rightPanel = document.getElementById('rightPanel');
            
            resizeHandle.addEventListener('mousedown', startResize);
            document.addEventListener('mousemove', doResize);
            document.addEventListener('mouseup', stopResize);
        }

        function startResize(e) {
            isResizing = true;
            startX = e.clientX;
            const rightPanel = document.getElementById('rightPanel');
            startWidth = parseInt(window.getComputedStyle(rightPanel).getPropertyValue('flex-basis'), 10);
            
            document.body.style.cursor = 'col-resize';
            document.body.style.userSelect = 'none';
        }

        function doResize(e) {
            if (!isResizing) return;
            
            const diff = startX - e.clientX;
            const newWidth = startWidth + diff;
            const rightPanel = document.getElementById('rightPanel');
            
            const minWidth = 400;
            const maxWidth = 1000;
            const constrainedWidth = Math.max(minWidth, Math.min(maxWidth, newWidth));
            
            rightPanel.style.flexBasis = constrainedWidth + 'px';
        }

        function stopResize(e) {
            if (!isResizing) return;
            
            isResizing = false;
            document.body.style.cursor = '';
            document.body.style.userSelect = '';
        }

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initializeResize();
            
            // „Éá„Éï„Ç©„É´„Éà„Åß„Çµ„É≥„Éó„É´„Ç≥„Éº„Éâ„ÇíË™≠„ÅøËæº„Åø
            loadSampleCode('basic');
        });
    </script>
    
    <!-- ÂÖ±ÈÄö„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥Ê©üËÉΩ -->
    <script src="js/navigation.js"></script>
</body>
</html>